# SPDX-License-Identifier: AGPL-3.0-or-later
# cargo-mutants configuration for copybook-rs
# See: https://mutants.rs/config-file.html
#
# Usage: cargo mutants --config mutants.toml [--package <crate>]
# CI uses --config mutants.toml to load this from the repo root.

# --- Test runner ---
test_tool = "nextest"

# --- Timeout tuning ---
# Multiplier applied to baseline test duration for mutant timeout
timeout_multiplier = 3.0
# Floor timeout (seconds) to avoid flaky kills on fast tests
minimum_test_timeout = 20.0
# Multiplier applied to baseline build duration
build_timeout_multiplier = 2.0

# --- Concurrency ---
# Cap lints to avoid warnings causing build failures in mutated code
cap_lints = true

# --- Feature activation ---
# Enable comprehensive-tests feature so all code paths are exercised
features = ["comprehensive-tests"]

# --- Source file targeting ---
# Focus mutation testing on the most critical crates
examine_globs = [
    "crates/copybook-core/src/**/*.rs",
    "crates/copybook-codec/src/**/*.rs",
    "crates/copybook-error/src/**/*.rs",
    "crates/copybook-overpunch/src/**/*.rs",
    "crates/copybook-overflow/src/**/*.rs",
]

# Exclude non-production code even within targeted crates
exclude_globs = [
    # Test and bench harnesses
    "**/tests/**",
    "**/benches/**",
    "**/examples/**",
    # Build scripts
    "**/build.rs",
    # Tools and test-only crates (belt-and-suspenders with examine_globs)
    "tools/**",
    "tests/**",
    # Generated / fixture code
    "**/*_gen.rs",
    "fixtures/**",
]

# --- Mutant name filters (regex) ---
# Exclude trivial / boilerplate mutations that produce noise
exclude_re = [
    # Display and Debug trait impls – cosmetic, not logic
    "impl (Display|Debug) for",
    # From/Into conversions – type plumbing
    "impl From<.+> for",
    "impl Into<.+> for",
    # Error trait boilerplate
    "fn source\\(",
    "fn description\\(",
    # Trivial Default impls
    "impl Default for",
]

# --- Skip calls to noisy functions ---
# Mutations inside calls to these are skipped (logging, panics, etc.)
skip_calls = [
    "log",
    "trace",
    "debug",
    "info",
    "warn",
    "error",
    "println",
    "eprintln",
    "write",
    "writeln",
    "unreachable",
    "todo",
    "unimplemented",
    "tracing::instrument",
]
skip_calls_defaults = true
