{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://copybook-rs.org/schemas/record-format.json",
  "title": "COBOL Record Format Schema",
  "description": "JSON schema for decoded COBOL record format",
  "type": "object",
  "properties": {
    "schema": {
      "type": "string",
      "const": "copybook.v1"
    },
    "record_index": {
      "type": "integer",
      "minimum": 0,
      "description": "0-based record number"
    },
    "codepage": {
      "type": "string",
      "description": "Code page identifier used for decoding"
    },
    "offset": {
      "type": "integer",
      "minimum": 0,
      "description": "Byte offset in source stream (when available)"
    },
    "length": {
      "type": "integer",
      "minimum": 0,
      "description": "Decoded record length in bytes"
    },
    "schema_fingerprint": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "Stable schema fingerprint"
    },
    "raw_b64": {
      "type": "string",
      "pattern": "^[A-Za-z0-9+/]*={0,2}$",
      "description": "Base64-encoded record bytes (when `emit_raw` is enabled)"
    },
    "fields": {
      "type": "object",
      "patternProperties": {
        "^[A-Z][A-Z0-9_-]*(__dup[0-9]+)?$": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" },
            { "type": "boolean" },
            { "type": "null" },
            {
              "type": "array",
              "items": { "type": "object" }
            },
            { "type": "object" }
          ]
        },
        "^_filler_[0-9]+$": {
          "oneOf": [
            { "type": "string" },
            { "type": "number" },
            { "type": "boolean" },
            { "type": "null" }
          ],
          "description": "FILLER fields with byte offset naming"
        },
        ".*_raw_b64$": {
          "type": "string",
          "pattern": "^[A-Za-z0-9+/]*={0,2}$",
          "description": "Field-level base64 payload when `emit_raw=Field`"
        },
        "^_encoding_metadata$": {
          "type": "object",
          "description": "Optional encoding metadata (e.g., preserved zoned format)"
        }
      },
      "additionalProperties": true
    },
    "errors": {
      "type": "array",
      "items": {
        "type": "object"
      },
      "description": "Optional error diagnostics captured during decoding"
    }
  },
  "required": ["schema", "record_index", "codepage", "fields"],
  "additionalProperties": false
}
