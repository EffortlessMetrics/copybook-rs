{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://copybook-rs.effortlessmetrics.com/schemas/security-receipt-v1.0.json",
  "title": "copybook-rs Security Scan Receipt",
  "description": "Enterprise compliance artifact for security scanning audit trail (SOX, HIPAA, GDPR, PCI DSS). Generated by cargo-audit CI integration and weekly security scans for regulatory compliance and audit verification.",
  "type": "object",
  "required": [
    "version",
    "timestamp",
    "commit_sha",
    "scan_type",
    "rust_version",
    "tools",
    "vulnerabilities",
    "exit_status"
  ],
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Security receipt schema version for evolution management"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of scan execution (UTC), e.g., '2025-10-02T12:00:00Z'"
    },
    "commit_sha": {
      "type": "string",
      "pattern": "^[0-9a-f]{40}$",
      "description": "Git commit SHA (full 40 characters) for code version traceability"
    },
    "scan_type": {
      "type": "string",
      "enum": ["pr-gate", "weekly-scan", "manual"],
      "description": "Scan execution context: pr-gate (CI PR quality gate), weekly-scan (scheduled proactive scan), manual (ad-hoc audit)"
    },
    "rust_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+",
      "description": "Rust toolchain version used for scan (e.g., '1.90.0') for reproducibility"
    },
    "tools": {
      "type": "object",
      "required": ["cargo_audit", "cargo_deny"],
      "properties": {
        "cargo_audit": {
          "type": "string",
          "description": "cargo-audit version (e.g., '0.21.2')"
        },
        "cargo_deny": {
          "type": "string",
          "description": "cargo-deny version (e.g., '0.16.0')"
        },
        "cargo_geiger": {
          "type": "string",
          "description": "cargo-geiger version (optional, e.g., '0.13.0')"
        }
      },
      "additionalProperties": false,
      "description": "Security tooling versions for audit trail verification"
    },
    "vulnerabilities": {
      "type": "object",
      "required": ["count", "by_severity", "advisories"],
      "properties": {
        "count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total vulnerability count across all severity levels"
        },
        "by_severity": {
          "type": "object",
          "required": ["critical", "high", "medium", "low"],
          "properties": {
            "critical": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of CRITICAL severity vulnerabilities (immediate action required)"
            },
            "high": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of HIGH severity vulnerabilities (priority remediation)"
            },
            "medium": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of MEDIUM severity vulnerabilities (scheduled remediation)"
            },
            "low": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of LOW severity vulnerabilities (tracked for awareness)"
            }
          },
          "additionalProperties": false,
          "description": "Vulnerability breakdown by CVSS severity classification"
        },
        "advisories": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "severity", "crate", "version"],
            "properties": {
              "id": {
                "type": "string",
                "pattern": "^RUSTSEC-\\d{4}-\\d{4}$",
                "description": "RustSec advisory ID (e.g., 'RUSTSEC-2024-0001')"
              },
              "severity": {
                "type": "string",
                "enum": ["critical", "high", "medium", "low"],
                "description": "CVSS severity classification"
              },
              "crate": {
                "type": "string",
                "description": "Affected crate name (e.g., 'serde_json')"
              },
              "version": {
                "type": "string",
                "description": "Affected crate version (e.g., '1.0.145')"
              },
              "title": {
                "type": "string",
                "description": "Advisory title (human-readable vulnerability description)"
              },
              "url": {
                "type": "string",
                "format": "uri",
                "description": "RustSec advisory URL for detailed information"
              },
              "cvss": {
                "type": "string",
                "pattern": "^CVSS:\\d\\.\\d/.*",
                "description": "CVSS vector string (e.g., 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H')"
              },
              "patched": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Patched versions that resolve the vulnerability (e.g., ['>=1.0.146'])"
              }
            },
            "additionalProperties": false
          },
          "description": "Detailed vulnerability advisories from RustSec database"
        }
      },
      "additionalProperties": false,
      "description": "Vulnerability detection results with severity breakdown"
    },
    "scan_duration_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Scan execution time in milliseconds for performance monitoring"
    },
    "exit_status": {
      "type": "string",
      "enum": ["success", "vulnerabilities_found", "error"],
      "description": "Scan result status: success (no vulnerabilities), vulnerabilities_found (action required), error (scan failure)"
    },
    "workflow_run_id": {
      "type": "string",
      "description": "GitHub Actions workflow run ID for traceability (e.g., '1234567890')"
    },
    "advisory_db_version": {
      "type": "object",
      "properties": {
        "last_commit": {
          "type": "string",
          "pattern": "^[0-9a-f]{40}$",
          "description": "RustSec advisory database last commit SHA"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "RustSec advisory database last update timestamp"
        },
        "advisory_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total advisory count in database at scan time"
        }
      },
      "description": "RustSec advisory database metadata for supply chain verification"
    },
    "crates_io_snapshot": {
      "type": "string",
      "format": "uri",
      "description": "crates.io index snapshot URL for supply chain verification (e.g., 'https://github.com/rust-lang/crates.io-index/commit/abc123...')"
    },
    "unsafe_code_metrics": {
      "type": "object",
      "properties": {
        "total_functions": {
          "type": "integer",
          "minimum": 0,
          "description": "Total unsafe functions detected (expected: 0 for copybook-rs)"
        },
        "total_expressions": {
          "type": "integer",
          "minimum": 0,
          "description": "Total unsafe expressions detected (expected: 0 for copybook-rs)"
        },
        "crates": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "unsafe_functions", "unsafe_expressions"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Crate name"
              },
              "unsafe_functions": {
                "type": "integer",
                "minimum": 0,
                "description": "Unsafe function count in crate"
              },
              "unsafe_expressions": {
                "type": "integer",
                "minimum": 0,
                "description": "Unsafe expression count in crate"
              }
            }
          },
          "description": "Per-crate unsafe code breakdown"
        }
      },
      "description": "cargo-geiger unsafe code metrics (optional, included when cargo-geiger job runs)"
    },
    "compliance_metadata": {
      "type": "object",
      "properties": {
        "sox_compliant": {
          "type": "boolean",
          "description": "SOX compliance indicator (artifact retention, traceability)"
        },
        "hipaa_compliant": {
          "type": "boolean",
          "description": "HIPAA compliance indicator (vulnerability management)"
        },
        "pci_dss_compliant": {
          "type": "boolean",
          "description": "PCI DSS compliance indicator (secure development practices)"
        },
        "gdpr_compliant": {
          "type": "boolean",
          "description": "GDPR compliance indicator (data protection measures)"
        },
        "retention_days": {
          "type": "integer",
          "minimum": 0,
          "description": "Artifact retention days (default: 90)"
        },
        "audit_id": {
          "type": "string",
          "description": "Enterprise audit trail identifier for SIEM integration"
        }
      },
      "description": "Enterprise compliance metadata for regulatory audit trails"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "version": "1.0",
      "timestamp": "2025-10-02T12:00:00Z",
      "commit_sha": "abc123def456abc123def456abc123def456abc1",
      "scan_type": "pr-gate",
      "rust_version": "1.90.0",
      "tools": {
        "cargo_audit": "0.21.2",
        "cargo_deny": "0.16.0",
        "cargo_geiger": "0.13.0"
      },
      "vulnerabilities": {
        "count": 0,
        "by_severity": {
          "critical": 0,
          "high": 0,
          "medium": 0,
          "low": 0
        },
        "advisories": []
      },
      "scan_duration_ms": 45000,
      "exit_status": "success",
      "workflow_run_id": "1234567890",
      "advisory_db_version": {
        "last_commit": "f71b77f025d1c2afcd2b07a32e7127a5d138ef4a",
        "last_updated": "2025-10-02T12:04:17Z",
        "advisory_count": 820
      },
      "unsafe_code_metrics": {
        "total_functions": 0,
        "total_expressions": 0,
        "crates": [
          {
            "name": "copybook-core",
            "unsafe_functions": 0,
            "unsafe_expressions": 0
          },
          {
            "name": "copybook-codec",
            "unsafe_functions": 0,
            "unsafe_expressions": 0
          }
        ]
      },
      "compliance_metadata": {
        "sox_compliant": true,
        "hipaa_compliant": true,
        "pci_dss_compliant": true,
        "gdpr_compliant": true,
        "retention_days": 90,
        "audit_id": "copybook-rs-security-2025-10-02-abc123"
      }
    },
    {
      "version": "1.0",
      "timestamp": "2025-10-02T15:30:00Z",
      "commit_sha": "def456abc123def456abc123def456abc123def4",
      "scan_type": "weekly-scan",
      "rust_version": "1.90.0",
      "tools": {
        "cargo_audit": "0.21.2",
        "cargo_deny": "0.16.0"
      },
      "vulnerabilities": {
        "count": 2,
        "by_severity": {
          "critical": 0,
          "high": 1,
          "medium": 1,
          "low": 0
        },
        "advisories": [
          {
            "id": "RUSTSEC-2024-0001",
            "severity": "high",
            "crate": "example-crate",
            "version": "1.2.3",
            "title": "Buffer overflow in parsing logic",
            "url": "https://rustsec.org/advisories/RUSTSEC-2024-0001",
            "cvss": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H",
            "patched": [">=1.2.4"]
          },
          {
            "id": "RUSTSEC-2024-0002",
            "severity": "medium",
            "crate": "another-crate",
            "version": "0.5.1",
            "title": "Information disclosure via error messages",
            "url": "https://rustsec.org/advisories/RUSTSEC-2024-0002",
            "cvss": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N",
            "patched": [">=0.5.2"]
          }
        ]
      },
      "scan_duration_ms": 52000,
      "exit_status": "vulnerabilities_found",
      "workflow_run_id": "9876543210",
      "advisory_db_version": {
        "last_commit": "a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2",
        "last_updated": "2025-10-02T15:00:00Z",
        "advisory_count": 825
      },
      "compliance_metadata": {
        "sox_compliant": false,
        "hipaa_compliant": false,
        "pci_dss_compliant": false,
        "gdpr_compliant": false,
        "retention_days": 90,
        "audit_id": "copybook-rs-security-2025-10-02-def456"
      }
    }
  ]
}
